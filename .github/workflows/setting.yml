
on: [push, pull_request]

# GitHub Action Set $GITHUB_ENV Not Saving
# 2022
# https://stackoverflow.com/questions/71333335/github-action-set-github-env-not-saving

jobs:

  build_ubuntu_latest:
    runs-on: ubuntu-latest

    steps:
    - name: Set the value
      id: step_one
      shell: bash
      run: |
        echo "action_state=yellow" >> $GITHUB_ENV
        echo "State is: '${{ env.action_state }}'" # No output since same step

    - name: Use the value
      id: step_two
      shell: bash
      run: |
        echo "Action State is: '${{ env.action_state }}'" # Output works

    - name: Use the value again 1
      id: step_two1
      run: |
        echo "Action State is: '${{ env.action_state }}'" # Output works
        
    - name: Use the value again 2
      id: step_two2
      shell: cmd
      run: |
        set action_state=${{ env.action_state }} # Setting works ("echo" is broken using shell "cmd")

        
  build_windows_latest:
    runs-on: windows-latest

    steps:
    - name: Set the value
      id: step_one
      run: |
        Add-Content -Path ${env:GITHUB_ENV}  -Value 'sleep_state=red' 
        
    - name: Use the value again 1
      id: step_two1
      run: |
        echo "Sleep State is: '${{ env.sleep_state }}'" # Output works
        
    - name: Use the value again 2
      id: step_two2
      shell: cmd
      run: |
        set sleep_state=${{ env.sleep_state }} # Setting works

